<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Bot HTML Generator</title>
    
    <!-- Office.js API -->
    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    
    <!-- React –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- –°—Ç–∏–ª–∏ -->
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f5f5f5;
        }

        #root {
            height: 100vh;
            overflow: hidden;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è Office Add-in –ø–∞–Ω–µ–ª–∏ */
        .ms-TaskPane {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .ms-TaskPane-content {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            display: inline-block;
            padding: 8px 16px;
            margin: 4px 8px 4px 0;
            font-size: 14px;
            font-weight: 400;
            line-height: 1.5;
            text-align: center;
            text-decoration: none;
            vertical-align: middle;
            cursor: pointer;
            border: 1px solid transparent;
            border-radius: 4px;
            transition: all 0.15s ease-in-out;
            user-select: none;
        }

        .btn:hover {
            text-decoration: none;
        }

        .btn:focus {
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        .btn-primary {
            color: #fff;
            background-color: #007bff;
            border-color: #007bff;
        }

        .btn-primary:hover {
            color: #fff;
            background-color: #0056b3;
            border-color: #004085;
        }

        .btn-secondary {
            color: #fff;
            background-color: #6c757d;
            border-color: #6c757d;
        }

        .btn-secondary:hover {
            color: #fff;
            background-color: #545b62;
            border-color: #4e555b;
        }

        .btn-outline {
            color: #007bff;
            background-color: transparent;
            border-color: #007bff;
        }

        .btn-outline:hover {
            color: #fff;
            background-color: #007bff;
            border-color: #007bff;
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 12px;
        }

        .btn-lg {
            padding: 12px 24px;
            font-size: 16px;
        }

        .btn:disabled {
            opacity: 0.65;
            cursor: not-allowed;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            margin-bottom: 16px;
        }

        .card-header {
            padding: 12px 16px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            border-radius: 8px 8px 0 0;
            font-weight: 600;
        }

        .card-body {
            padding: 16px;
        }

        .card-footer {
            padding: 12px 16px;
            background-color: #f8f9fa;
            border-top: 1px solid #dee2e6;
            border-radius: 0 0 8px 8px;
        }

        /* –£—Ç–∏–ª–∏—Ç—ã */
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        .text-muted { color: #6c757d; }
        .text-primary { color: #007bff; }
        .text-success { color: #28a745; }
        .text-danger { color: #dc3545; }

        .mb-0 { margin-bottom: 0; }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 1rem; }
        .mb-4 { margin-bottom: 1.5rem; }
        .mb-5 { margin-bottom: 3rem; }

        .mt-0 { margin-top: 0; }
        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-3 { margin-top: 1rem; }
        .mt-4 { margin-top: 1.5rem; }
        .mt-5 { margin-top: 3rem; }

        .d-none { display: none; }
        .d-block { display: block; }
        .d-flex { display: flex; }
        .d-inline { display: inline; }
        .d-inline-block { display: inline-block; }

        .flex-column { flex-direction: column; }
        .flex-row { flex-direction: row; }
        .justify-content-center { justify-content: center; }
        .justify-content-between { justify-content: space-between; }
        .align-items-center { align-items: center; }

        .w-100 { width: 100%; }
        .h-100 { height: 100%; }

        /* –°–æ—Å—Ç–æ—è–Ω–∏—è */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .error {
            color: #dc3545;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            padding: 8px 12px;
            margin-bottom: 16px;
        }

        .success {
            color: #155724;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 4px;
            padding: 8px 12px;
            margin-bottom: 16px;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .spinner {
            animation: spin 1s linear infinite;
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #007bff;
            border-radius: 50%;
            margin-right: 8px;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .ms-TaskPane-content {
                padding: 8px;
                gap: 12px;
            }
            
            .card-body {
                padding: 12px;
            }
            
            .btn {
                width: 100%;
                margin: 4px 0;
            }
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="ms-TaskPane">
            <div class="ms-TaskPane-content">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h3 class="mb-0">Bot HTML Generator</h3>
                            <button class="btn btn-primary btn-sm" onclick="refreshDocument()">
                                –û–±–Ω–æ–≤–∏—Ç—å
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="status">
                            <p class="text-muted">–ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å" –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞</p>
                        </div>
                        <div id="content" style="display: none;">
                            <h5>–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞:</h5>
                            <div class="content-preview">
                                <pre id="documentContent" style="white-space: pre-wrap; font-size: 12px; max-height: 200px; overflow: auto; background-color: #f8f9fa; padding: 12px; border-radius: 4px; border: 1px solid #dee2e6;"></pre>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="mb-0">–ü—Ä–µ–≤—å—é HTML</h3>
                    </div>
                    <div class="card-body">
                        <div id="previewContainer">
                            <p class="text-muted text-center">–ü—Ä–µ–≤—å—é –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ—Å–ª–µ —á—Ç–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="mb-0">–î–µ–π—Å—Ç–≤–∏—è</h3>
                    </div>
                    <div class="card-body">
                        <div class="d-flex flex-column gap-2">
                            <button class="btn btn-outline" onclick="copyHTML()" disabled id="copyHtmlBtn">
                                üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å HTML
                            </button>
                            <button class="btn btn-outline" onclick="copyHTMLWithCSS()" disabled id="copyHtmlCssBtn">
                                üé® –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å HTML+CSS
                            </button>
                            <button class="btn btn-primary" onclick="openPreview()" disabled id="openPreviewBtn">
                                üëÅÔ∏è –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–µ–≤—å—é
                            </button>
                            <button class="btn btn-secondary" onclick="savePDF()" disabled id="savePdfBtn">
                                üìÑ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å PDF
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body p-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="status-info">
                                <span class="text-muted">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</span>
                            </div>
                            <div class="status-actions">
                                <small class="text-muted">Bot HTML v1.0.0</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let documentContent = '';
        let previewHTML = '';
        let isLoading = false;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Office.js
        Office.onReady(() => {
            console.log('Office.js –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ');
            updateStatus('Office.js –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
        });

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞
        async function refreshDocument() {
            if (isLoading) return;
            
            isLoading = true;
            updateStatus('–ß—Ç–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞...', 'loading');
            
            try {
                // –ß–∏—Ç–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
                await Word.run(async (context) => {
                    const body = context.document.body;
                    const paragraphs = body.paragraphs;
                    paragraphs.load('text');
                    
                    await context.sync();
                    
                    documentContent = '';
                    for (const paragraph of paragraphs.items) {
                        if (paragraph.text.trim()) {
                            documentContent += paragraph.text + '\n';
                        }
                    }
                });

                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º HTML –ø—Ä–µ–≤—å—é
                previewHTML = generatePreview(documentContent);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                updateDocumentDisplay();
                updatePreviewDisplay();
                enableButtons();
                
                updateStatus('–î–æ–∫—É–º–µ–Ω—Ç –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:', error);
                updateStatus('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞: ' + error.message, 'error');
            } finally {
                isLoading = false;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–µ–≤—å—é
        function generatePreview(content) {
            // –ü—Ä–æ—Å—Ç–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è HTML (–∑–¥–µ—Å—å –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–∞—Ä—Å–µ—Ä Bot HTML)
            const lines = content.split('\n').filter(line => line.trim());
            
            let html = '<div class="bot-container">';
            html += '<h1>–ü—Ä–µ–≤—å—é –¥–æ–∫—É–º–µ–Ω—Ç–∞</h1>';
            html += '<div class="bot-content">';
            
            lines.forEach(line => {
                if (line.trim()) {
                    html += `<p>${line}</p>`;
                }
            });
            
            html += '</div>';
            html += '</div>';
            
            return html;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞
        function updateDocumentDisplay() {
            const statusDiv = document.getElementById('status');
            const contentDiv = document.getElementById('content');
            const documentContentPre = document.getElementById('documentContent');
            
            if (documentContent) {
                statusDiv.style.display = 'none';
                contentDiv.style.display = 'block';
                documentContentPre.textContent = documentContent;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–≤—å—é
        function updatePreviewDisplay() {
            const previewContainer = document.getElementById('previewContainer');
            
            if (previewHTML) {
                previewContainer.innerHTML = `
                    <iframe
                        srcDoc="
                            <!DOCTYPE html>
                            <html lang='ru'>
                            <head>
                                <meta charset='UTF-8'>
                                <meta name='viewport' content='width=device-width, initial-scale=1.0'>
                                <style>
                                    body { margin: 0; padding: 16px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
                                    .bot-container { max-width: 100%; }
                                    .bot-content p { margin-bottom: 10px; line-height: 1.6; }
                                    h1 { color: #333; margin-bottom: 20px; }
                                    img { max-width: 100%; height: auto; }
                                </style>
                            </head>
                            <body>
                                ${previewHTML}
                            </body>
                            </html>
                        "
                        style="width: 100%; height: 400px; border: 1px solid #dee2e6; border-radius: 4px; background-color: #fff;"
                        title="HTML Preview"
                    ></iframe>
                `;
            }
        }

        // –í–∫–ª—é—á–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
        function enableButtons() {
            document.getElementById('copyHtmlBtn').disabled = false;
            document.getElementById('copyHtmlCssBtn').disabled = false;
            document.getElementById('openPreviewBtn').disabled = false;
            document.getElementById('savePdfBtn').disabled = false;
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ HTML
        function copyHTML() {
            navigator.clipboard.writeText(previewHTML).then(() => {
                updateStatus('HTML —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
            }).catch(err => {
                console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
                updateStatus('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å HTML', 'error');
            });
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ HTML —Å CSS
        function copyHTMLWithCSS() {
            const htmlWithCSS = `
<style>
.bot-container { max-width: 1200px; margin: 0 auto; padding: 20px; }
.bot-content p { margin-bottom: 10px; line-height: 1.6; }
h1 { color: #333; margin-bottom: 20px; }
h2 { color: #555; margin-bottom: 15px; }
h3 { color: #666; margin-bottom: 10px; }
img { max-width: 100%; height: auto; }
.bot-card { border: 1px solid #ddd; border-radius: 8px; padding: 16px; margin-bottom: 16px; }
.bot-btn { display: inline-block; padding: 8px 16px; background-color: #007bff; color: white; text-decoration: none; border-radius: 4px; margin: 4px; }
.bot-btn:hover { background-color: #0056b3; }
</style>
${previewHTML}
            `;
            
            navigator.clipboard.writeText(htmlWithCSS).then(() => {
                updateStatus('HTML —Å CSS —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
            }).catch(err => {
                console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
                updateStatus('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å HTML —Å CSS', 'error');
            });
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–µ–≤—å—é
        function openPreview() {
            const newWindow = window.open('', '_blank');
            if (newWindow) {
                newWindow.document.write(`
                    <!DOCTYPE html>
                    <html lang="ru">
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <title>Bot HTML Preview</title>
                        <style>
                            body { margin: 0; padding: 20px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
                            .bot-container { max-width: 1200px; margin: 0 auto; }
                            .bot-content p { margin-bottom: 10px; line-height: 1.6; }
                            h1 { color: #333; margin-bottom: 20px; }
                            h2 { color: #555; margin-bottom: 15px; }
                            h3 { color: #666; margin-bottom: 10px; }
                            img { max-width: 100%; height: auto; }
                            .bot-card { border: 1px solid #ddd; border-radius: 8px; padding: 16px; margin-bottom: 16px; }
                            .bot-btn { display: inline-block; padding: 8px 16px; background-color: #007bff; color: white; text-decoration: none; border-radius: 4px; margin: 4px; }
                            .bot-btn:hover { background-color: #0056b3; }
                        </style>
                    </head>
                    <body>
                        ${previewHTML}
                    </body>
                    </html>
                `);
                newWindow.document.close();
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ PDF
        function savePDF() {
            const printWindow = window.open('', '_blank');
            if (printWindow) {
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html lang="ru">
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <title>Bot HTML PDF</title>
                        <style>
                            body { margin: 0; padding: 20px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
                            .bot-container { max-width: 100%; }
                            .bot-content p { margin-bottom: 10px; line-height: 1.6; }
                            h1 { color: #333; margin-bottom: 20px; }
                            h2 { color: #555; margin-bottom: 15px; }
                            h3 { color: #666; margin-bottom: 10px; }
                            img { max-width: 100%; height: auto; }
                            @media print {
                                body { margin: 0; }
                                .no-print { display: none; }
                            }
                            @page {
                                margin: 1in;
                                size: A4;
                            }
                        </style>
                    </head>
                    <body>
                        ${previewHTML}
                    </body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.print();
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus(message, type = 'info') {
            const statusInfo = document.querySelector('.status-info span');
            if (statusInfo) {
                statusInfo.textContent = message;
                statusInfo.className = `text-${type}`;
                
                if (type === 'loading') {
                    statusInfo.innerHTML = `<span class="spinner"></span>${message}`;
                }
            }
        }
    </script>
</body>
</html>
